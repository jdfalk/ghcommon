# file: .github/workflows/security.yml
# version: 1.1.1
# guid: s3c4r5t6-y7a8-b9c0-d1e2-f3a4b5c6d7e8

name: Security

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
  schedule:
    - cron: "0 6 * * 1" # Weekly on Monday at 6 AM UTC
  workflow_dispatch:

permissions:
  actions: read
  contents: read
  security-events: write
  issues: write
  pull-requests: write

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

env:
  GO_VERSION: "1.24"
  NODE_VERSION: "22"
  PYTHON_VERSION: "3.12"

jobs:
  # Detect what languages/frameworks are in use
  detect-languages:
    name: Detect Languages
    runs-on: ubuntu-latest
    outputs:
      languages: ${{ steps.detect.outputs.languages }}
      languages_json: ${{ steps.detect.outputs.languages_json }}
      has_go: ${{ steps.detect.outputs.has_go }}
      has_javascript: ${{ steps.detect.outputs.has_javascript }}
      has_python: ${{ steps.detect.outputs.has_python }}
      has_rust: ${{ steps.detect.outputs.has_rust }}
      has_docker: ${{ steps.detect.outputs.has_docker }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5
        with:
          fetch-depth: 0

      - name: Detect project languages
        id: detect
        run: python3 .github/scripts/sync-release-detect-language.py