# file: .github/workflows/release-rust.yml
# version: 1.1.3
# guid: release-rust-workflow-2025-10

name: Rust Release Build

on:
  workflow_call:
    inputs:
      release-version:
        description: 'Release version tag'
        required: false
        type: string
      protobuf-artifacts:
        description: 'Whether protobuf artifacts were generated'
        required: false
        type: string
        default: 'false'

permissions:
  contents: read
  packages: write

jobs:
  build-rust:
    name: Build Rust (stable)
    runs-on: ubuntu-latest
    env:
      RELEASE_VERSION: ${{ inputs.release-version }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2

      - name: Download protobuf artifacts
        if: inputs.protobuf-artifacts == 'true'
        uses: actions/download-artifact@37930b1c2abaa49bbe596cd826c3c89aef350131 # v7.0.0
        with:
          name: protobuf-generated
          path: proto-generated

      - name: Build and test Rust (no publish)
        uses: jdfalk/release-rust-action@2456956eba08a7236def9c3e6b356cd053829fdf # v1.0.1
        with:
          rust-version: stable
          manifest-path: ./Cargo.toml
          crate-token: dummy-no-publish
          run-tests: 'true'
          run-clippy: 'true'
          check-format: 'true'
          dry-run: 'true'

      - name: Upload Rust artifacts
        if: always()
        uses: actions/upload-artifact@b7c566a772e6b6bfb58ed0dc250532a479d7789f # v6.0.0
        with:
          name: rust-build
          path: |
            target/release/*
          if-no-files-found: ignore
          retention-days: 14
