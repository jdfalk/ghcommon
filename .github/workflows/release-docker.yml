# file: .github/workflows/release-docker.yml
# version: 1.1.3
# guid: release-docker-workflow-2025-10

name: Docker Release Build

on:
  workflow_call:
    inputs:
      docker-matrix:
        description: 'JSON encoded Docker platform matrix'
        required: true
        type: string
      registry:
        description: 'Container registry hostname'
        required: true
        type: string
      image-name:
        description: 'Container image name'
        required: true
        type: string

permissions:
  contents: read
  packages: write

jobs:
  build-docker:
    name: Build Docker (${{ matrix.platform }})
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix: ${{ fromJSON(inputs.docker-matrix) }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1

      - name: Build and push image via action
        uses: jdfalk/release-docker-action@d82bf48d3e1c3d5259faec98c8410f39f3de45a4 # v1.0.2
        with:
          context: .
          dockerfile: Dockerfile
          platforms: ${{ matrix.platform }}
          registry: ${{ inputs.registry }}
          image-name: ${{ inputs.image-name }}
          tag: ${{ github.sha }}
          additional-tags: ${{ startsWith(github.ref, 'refs/tags/') && github.ref_name || '' }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
