# file: .github/workflows/release-docker.yml
# version: 1.1.0
# guid: release-docker-workflow-2025-10

name: Docker Release Build

on:
  workflow_call:
    inputs:
      docker-matrix:
        description: 'JSON encoded Docker platform matrix'
        required: true
        type: string
      registry:
        description: 'Container registry hostname'
        required: true
        type: string
      image-name:
        description: 'Container image name'
        required: true
        type: string

permissions:
  contents: read
  packages: write

jobs:
  build-docker:
    name: Build Docker (${{ matrix.platform }})
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix: ${{ fromJSON(inputs.docker-matrix) }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Build and push image via action
        uses: jdfalk/release-docker-action@7a5440f # v1.0.0
        with:
          context: .
          dockerfile: Dockerfile
          platforms: ${{ matrix.platform }}
          registry: ${{ inputs.registry }}
          image-name: ${{ inputs.image-name }}
          tag: ${{ github.sha }}
          additional-tags: ${{ startsWith(github.ref, 'refs/tags/') && github.ref_name || '' }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
